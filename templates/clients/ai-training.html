{% extends 'base/base.html' %}

{% block title %}AI Training ‚Äî Resto Admin{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/ai-training.css')}}">
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <div class="ai-header">
        <h2>AI Training Data Management</h2>
        <p>Upload training files and knowledge bases to enhance your AI agent's responses</p>
    </div>

    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card-surface mb-4">
                <h5 class="mb-4">Upload Training Files</h5>
                
                <div class="templates-section mb-4">
                    <h6 class="mb-3">Start with a Template</h6>
                    <div class="d-flex gap-2 flex-wrap">
                        <button class="btn btn-sm btn-outline-secondary" onclick="downloadTemplate('menu')">
                            <i class="fa fa-download"></i> Restaurant Menu Template
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="downloadTemplate('faq')">
                            <i class="fa fa-download"></i> FAQ Template
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="downloadTemplate('hours')">
                            <i class="fa fa-download"></i> Business Hours Template
                        </button>
                    </div>
                </div>
                
                <div class="upload-section" id="uploadZone">
                    <div class="upload-icon">üìÅ</div>
                    <h5>Drag & Drop Files Here</h5>
                    <p style="color:#666; margin-bottom:20px;">or click to browse your computer</p>
                    <div class="file-input-wrapper">
                        <button class="btn btn-primary" style="background:#667eea; border:none;">Choose Files</button>
                        <input type="file" id="trainingFiles" name="training_files" multiple accept=".txt,.pdf,.docx,.json,.csv">
                    </div>
                    <p style="color:#999; font-size:0.85rem; margin-top:20px;">Supported formats: TXT, PDF, DOCX, JSON, CSV</p>
                </div>

                <div id="uploadProgress" style="display:none; margin-top:20px;">
                    <div id="uploadQueue"></div>
                </div>
                
                <div id="validationMessages" style="margin-top:15px;"></div>
            </div>

            <div class="card-surface">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="mb-0">Uploaded Training Files</h5>
                    <div id="bulkActions" class="bulk-actions" style="display:none;">
                        <input type="checkbox" id="selectAll" class="me-2"> 
                        <span class="text-muted me-3"><span id="selectedCount">0</span> selected</span>
                        <button class="btn btn-sm btn-danger" id="deleteSelectedBtn">
                            <i class="fa fa-trash"></i> Delete Selected
                        </button>
                    </div>
                </div>
                
                <div id="filesList"></div>

                <div style="margin-top:20px; padding-top:20px; border-top:1px solid #eee;">
                    <button id="retrainBtn" class="btn btn-secondary" style="background:#667eea; border:none; margin-right:10px;" disabled>Retrain All Models</button>
                    <button id="exportBtn" class="btn btn-outline-secondary" disabled>Export Training Data</button>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="filesCount">0</div>
                    <div class="stat-label">Files Uploaded</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalSize">0 KB</div>
                    <div class="stat-label">Total Size</div>
                </div>
            </div>

            <div class="info-box">
                <h5>Training File Guidelines</h5>
                <ul>
                    <li><strong>TXT Files:</strong> Plain text data, Q&A pairs, or knowledge base</li>
                    <li><strong>JSON Files:</strong> Structured data with menu items, FAQs, or responses</li>
                    <li><strong>CSV Files:</strong> Tabular data like inventory, pricing, hours</li>
                    <li><strong>PDF/DOCX:</strong> Documents with training content</li>
                </ul>
            </div>

            <div class="info-box" style="border-left-color:#ff6b6b;">
                <h5 style="color:#ff6b6b;">Best Practices</h5>
                <ul style="margin-bottom:0;">
                    <li>Use clear, consistent formatting</li>
                    <li>Include context for Q&A pairs</li>
                    <li>Update files regularly</li>
                    <li>Keep file sizes under 50MB</li>
                    <li>Avoid duplicate content</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="card-surface mb-4">
        <h5 class="mb-3">Example Training File Formats</h5>
        
        <div class="row">
            <div class="col-md-6">
                <h6>JSON Format (Recommended)</h6>
                <div class="code-example">{
  "restaurant": {
    "name": "Resto",
    "menu": [
      {
        "item": "Margherita Pizza",
        "price": "$12.99",
        "description": "Fresh tomato and basil"
      }
    ]
  }
}</div>
            </div>
            <div class="col-md-6">
                <h6>Q&A Format (TXT)</h6>
                <div class="code-example">Q: What are your hours?
A: We're open 10am-10pm daily

Q: Do you deliver?
A: Yes, delivery available within 5 miles

Q: Any vegetarian options?
A: Yes, check our full menu for marked items</div>
            </div>
        </div>
    </div>

    <div class="card-surface">
        <h5 class="mb-3">Training Status & History</h5>
        <table class="table mb-0">
            <thead style="background:#f8f9fa;">
                <tr>
                    <th>Date</th>
                    <th>Action</th>
                    <th>Status</th>
                    <th>Duration</th>
                </tr>
            </thead>
            <tbody id="trainingHistoryBody"></tbody>
        </table>
    </div>
</div>

<div id="previewModal" class="preview-modal" aria-hidden="true">
    <div class="preview-modal__content" role="dialog" aria-modal="true" aria-labelledby="previewTitle">
        <div class="preview-modal__header">
            <h5 id="previewTitle" class="mb-0">File Preview</h5>
            <button id="previewClose" class="preview-close" type="button" aria-label="Close preview">√ó</button>
        </div>
        <div id="previewMeta" class="preview-meta"></div>
        <pre id="previewBody" class="preview-body"></pre>
    </div>
</div>

<script src="{{ url_for('static', filename='js/ai-training.js')}}"></script>
{% endblock %}
