<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chatbot — Resto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      :root{--accent:#1f6feb; --bg:#f7f9fb; --bubble-light:#e9eefb; --bubble-dark:#d1e4ff}
      /* Responsive, mobile-first styles */
      html,body{height:100%}
      body{margin:0;font-family:Inter,system-ui,Arial,Helvetica,sans-serif;background:var(--bg);color:#0f172a;display:flex;align-items:center;justify-content:center;padding:12px}

      .chat-shell{width:100%;max-width:1100px;display:flex;gap:18px;align-items:flex-start;justify-content:center}

      /* Phone mock: mobile-first — almost full-screen on phones */
      .phone{width: min(420px, 98vw); background:#fff;border-radius:18px;box-shadow:0 10px 30px rgba(15,23,42,0.08);overflow:hidden;display:flex;flex-direction:column;height:calc(100vh - 32px);min-height:380px}
      .phone .header{padding:12px 16px;background:var(--accent);color:#fff;font-weight:700;text-align:center;font-size:clamp(1rem,1.6vw,1.2rem)}
      .phone .messages{flex:1;padding:14px 14px 110px 14px;overflow:auto;display:flex;flex-direction:column;gap:12px}

      .bubble{max-width:78%;padding:10px 14px;border-radius:14px;display:inline-block;font-size:clamp(.9rem,1.8vw,1rem)}
      .bubble.user{align-self:flex-end;background:var(--bubble-dark);border-bottom-right-radius:6px}
      .bubble.bot{align-self:flex-start;background:#f1f5f9;border-bottom-left-radius:6px}

      .composer{display:flex;padding:10px;border-top:1px solid #eef2f7;background:#fff}
      .composer input{flex:1;border:1px solid #e6eefc;padding:10px 12px;border-radius:999px;font-size:1rem}
      .composer button{margin-left:8px;border-radius:999px;padding:10px 14px;background:var(--accent);color:#fff;border:0}

      /* Desktop preview hidden on small screens */
      .desktop-preview{display:none}

      /* Larger screens: show preview side-by-side */
      @media(min-width:900px){
        body{padding:20px}
        .chat-shell{align-items:stretch}
        .phone{height:720px}
        .desktop-preview{display:block;flex:1;padding:22px}
        .menu-card{background:#fff;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(15,23,42,0.06);height:100%}
      }

      /* Very small screens: reduce vertical height so composer stays visible */
      @media(max-height:600px){
        .phone{height:64vh;min-height:380px}
      }
    </style>
  </head>
  <body>
    <div class="chat-shell">
      <div class="phone" id="phone">
        <div class="header" id="resto-name">Resto Name</div>
        <div class="messages" id="messages">
          <div class="bubble bot">Welcome! How can I help?</div>
          <div class="bubble user">I'd like to order.</div>
        </div>
        <div class="composer">
          <input id="txt" placeholder="Type message...">
          <button id="send">➤</button>
        </div>
      </div>

      <div class="desktop-preview">
        <div class="menu-card">
          <h4 id="preview-title">Chatbot Preview</h4>
          <p id="preview-menu">Menu and dynamic styling will apply here.</p>
        </div>
      </div>
    </div>

    <script>
      async function loadConfig(){
        try{
          const res = await fetch('/api/config');
          if(!res.ok) return {};
          return await res.json();
        }catch(e){return {}}
      }

      function applyConfig(cfg){
        if(!cfg) return;
        const root = document.documentElement;
        if(cfg.color_hex) root.style.setProperty('--accent', cfg.color_hex);
        if(cfg.menu_text) document.getElementById('preview-menu').textContent = cfg.menu_text;
        if(cfg.establishment_name) document.getElementById('resto-name').textContent = cfg.establishment_name;
        if(cfg.font_family) document.body.style.fontFamily = cfg.font_family + ', Arial, sans-serif';
      }

      function postMessage(text, from='user'){
        const div = document.createElement('div');
        div.className = 'bubble ' + (from==='user' ? 'user' : 'bot');
        div.textContent = text;
        document.getElementById('messages').appendChild(div);
        document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
      }

      document.getElementById('send').addEventListener('click', ()=>{
        const txt = document.getElementById('txt');
        const v = txt.value.trim();
        if(!v) return;
        postMessage(v,'user');
        txt.value='';
        // placeholder bot reply
        setTimeout(()=>postMessage('Got it — we are processing your order.', 'bot'), 700);
      });

      document.getElementById('txt').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); document.getElementById('send').click(); } });

      (async function(){ const cfg = await loadConfig(); applyConfig(cfg); })();
    </script>
  </body>
</html>
