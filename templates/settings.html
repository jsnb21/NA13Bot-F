{% extends 'base.html' %}

{% block title %}Settings — Resto Admin{% endblock %}

{% block head %}
<style>
    .settings-section {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .settings-section h5 {
        color: #0b343d;
        margin-bottom: 20px;
        border-bottom: 2px solid var(--sub-color, #ffd41d);
        padding-bottom: 10px;
        font-weight: 700;
    }
    .container-fluid h2 {
        font-weight: 700;
        color: #0b343d;
    }
    .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #f0f0f0;
    }
    .setting-row:last-child {
        border-bottom: none;
    }
    .setting-label {
        font-weight: 500;
    }
    .toggle-switch {
        position: relative;
        width: 50px;
        height: 24px;
        background-color: #ccc;
        border-radius: 12px;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    .toggle-switch.active {
        background-color: var(--sub-color);
    }
    .toggle-slider {
        position: absolute;
        top: 2px;
        left: 2px;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        transition: left 0.3s;
    }
    .toggle-switch.active .toggle-slider {
        left: 28px;
    }
    .color-wheel { width: 160px; height: 160px; }
    .color-hex-input { width: 120px; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="mb-4">
        <h2>Settings</h2>
    </div>

    <form method="post" id="settingsForm">
    <div class="settings-section">
        <h5>Business Information</h5>
        <div class="mb-3">
            <label for="business_name" class="form-label">Business Name</label>
            <input name="business_name" type="text" id="business_name" class="form-control" value="{{ cfg.get('business_name','Resto Restaurant') }}" />
        </div>
        <div class="mb-3">
            <label for="business_email" class="form-label">Business Email</label>
            <input name="business_email" type="email" id="business_email" class="form-control" value="{{ cfg.get('business_email','contact@restorestaurant.com') }}" />
        </div>
        <div class="mb-3">
            <label for="business_phone" class="form-label">Business Phone</label>
            <input name="business_phone" type="tel" id="business_phone" class="form-control" value="{{ cfg.get('business_phone','555-0123') }}" />
        </div>
        <div class="mb-3">
            <label for="business_address" class="form-label">Business Address</label>
            <input name="business_address" type="text" id="business_address" class="form-control" value="{{ cfg.get('business_address','123 Main St, City, State 12345') }}" />
        </div>
    </div>
    <div class="settings-section">
        <h5>Branding & Display</h5>
        <div class="mb-3">
            <label for="establishment_name" class="form-label">Establishment Name</label>
            <input id="establishment_name" name="establishment_name" type="text" class="form-control" placeholder="Your restaurant name" value="{{ cfg.get('establishment_name','') }}">
        </div>

        <div class="mb-3">
            <label for="logo_url" class="form-label">Logo URL</label>
            <input id="logo_url" name="logo_url" type="text" class="form-control" placeholder="https://example.com/logo.png" value="{{ cfg.get('logo_url','') }}">
        </div>

        <div class="row mb-3">
            <div class="col-6">
                <label for="main_color_picker" class="form-label">Main Color</label>
                <div class="d-flex align-items-center" style="gap:12px;">
                    <div id="main_color_picker" class="color-wheel"></div>
                    <div>
                        <input id="main_color" name="main_color" type="hidden" value="{{ cfg.get('main_color', cfg.get('color_hex','#1e40af')) }}">
                        <input id="main_color_hex" class="form-control color-hex-input" value="{{ cfg.get('main_color', cfg.get('color_hex','#1e40af')) }}">
                    </div>
                </div>
            </div>
            <div class="col-6">
                <label for="sub_color_picker" class="form-label">Accent / Sub Color</label>
                <div class="d-flex align-items-center" style="gap:12px;">
                    <div id="sub_color_picker" class="color-wheel"></div>
                    <div>
                        <input id="sub_color" name="sub_color" type="hidden" value="{{ cfg.get('sub_color', '#ffd41d') }}">
                        <input id="sub_color_hex" class="form-control color-hex-input" value="{{ cfg.get('sub_color', '#ffd41d') }}">
                    </div>
                </div>
            </div>
            
            <div class="col-12 mt-3">
                <label for="font_family" class="form-label">Select Font</label>
                <select id="font_family" name="font_family" class="form-select">
                    <option value="">-- default --</option>
                    <option value="Arial" {% if cfg.get('font_family','')=='Arial' %}selected{% endif %}>Arial</option>
                    <option value="Helvetica" {% if cfg.get('font_family','')=='Helvetica' %}selected{% endif %}>Helvetica</option>
                    <option value="Roboto" {% if cfg.get('font_family','')=='Roboto' %}selected{% endif %}>Roboto</option>
                    <option value="Georgia" {% if cfg.get('font_family','')=='Georgia' %}selected{% endif %}>Georgia</option>
                </select>
            </div>
        </div>

        <div class="mb-3">
            <label for="menu_text" class="form-label">Menu Text</label>
            <textarea id="menu_text" name="menu_text" rows="6" class="form-control" placeholder="Enter your menu items and descriptions">{{ cfg.get('menu_text','') }}</textarea>
        </div>

        <div class="mb-3">
            <label for="image_urls" class="form-label">Food Image URLs (one per line)</label>
            <textarea id="image_urls" name="image_urls" rows="4" class="form-control" placeholder="https://example.com/food1.jpg&#10;https://example.com/food2.jpg">{% for u in cfg.get('image_urls',[]) %}{{ u }}
{% endfor %}</textarea>
        </div>
    </div>

    <div class="settings-section">
        <h5>Notifications & Alerts</h5>
        <div class="setting-row">
            <span class="setting-label">Email Notifications on New Orders</span>
            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                <div class="toggle-slider"></div>
            </div>
        </div>
        <div class="setting-row">
            <span class="setting-label">SMS Alerts for Critical Issues</span>
            <div class="toggle-switch" onclick="this.classList.toggle('active')">
                <div class="toggle-slider"></div>
            </div>
        </div>
        <div class="setting-row">
            <span class="setting-label">Daily Sales Summary Email</span>
            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                <div class="toggle-slider"></div>
            </div>
        </div>
        <div class="setting-row">
            <span class="setting-label">Inventory Low Stock Alerts</span>
            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                <div class="toggle-slider"></div>
            </div>
        </div>
    </div>

    <div class="settings-section">
        <h5>Operating Hours</h5>
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="open_time" class="form-label">Opening Time</label>
                    <input name="open_time" type="time" id="open_time" class="form-control" value="{{ cfg.get('open_time','10:00') }}" />
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="close_time" class="form-label">Closing Time</label>
                    <input name="close_time" type="time" id="close_time" class="form-control" value="{{ cfg.get('close_time','22:00') }}" />
                </div>
            </div>
        </div>
        <div class="setting-row">
            <span class="setting-label">Enable Online Ordering</span>
            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                <div class="toggle-slider"></div>
            </div>
        </div>
        <div class="setting-row">
            <span class="setting-label">Enable Delivery</span>
            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                <div class="toggle-slider"></div>
            </div>
        </div>
    </div>

    <div class="settings-section">
        <h5>Payment Settings</h5>
        <div class="setting-row">
            <span class="setting-label">Credit Card Payments</span>
            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                <div class="toggle-slider"></div>
            </div>
        </div>
        <div class="setting-row">
            <span class="setting-label">Digital Wallet (Apple Pay, Google Pay)</span>
            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                <div class="toggle-slider"></div>
            </div>
        </div>
        <div class="setting-row">
            <span class="setting-label">Cash Payments</span>
            <div class="toggle-switch active" onclick="this.classList.toggle('active')">
                <div class="toggle-slider"></div>
            </div>
        </div>
        <div class="mb-3">
            <label for="tax_rate" class="form-label">Tax Rate (%)</label>
            <input name="tax_rate" type="number" id="tax_rate" class="form-control" value="{{ cfg.get('tax_rate',8.5) }}" step="0.1" />
        </div>
    </div>

    <div class="settings-section">
        <h5>Security & Privacy</h5>
        <div class="setting-row">
            <span class="setting-label">Two-Factor Authentication</span>
            <div class="toggle-switch" onclick="this.classList.toggle('active')">
                <div class="toggle-slider"></div>
            </div>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">Change Password</label>
            <input type="password" id="password" class="form-control" placeholder="Enter new password" />
        </div>
        <div class="mb-3">
            <label for="confirm_password" class="form-label">Confirm Password</label>
            <input type="password" id="confirm_password" class="form-control" placeholder="Confirm new password" />
        </div>
    </div>

        <div class="mb-4">
                <button type="submit" id="saveSettingsBtn" class="btn btn-secondary" style="background:#ff6b6b; border:none; margin-right:10px;">Save Settings</button>
                <button type="button" class="btn btn-outline-secondary" onclick="window.location.reload()">Cancel</button>
                <span id="saveStatus" style="margin-left:12px; color:#666; display:inline-block;"></span>
        </div>
        </form>

        <script>
        (function(){
            const form = document.getElementById('settingsForm');
            const btn = document.getElementById('saveSettingsBtn');
            const status = document.getElementById('saveStatus');

            form.addEventListener('submit', async function(e){
                e.preventDefault();
                btn.disabled = true;
                const orig = btn.innerHTML;
                btn.innerHTML = 'Saving...';
                status.textContent = '';
                try{
                    const data = new FormData(form);
                    const res = await fetch(window.location.pathname, { method: 'POST', body: data });
                    if(res.ok){
                        status.textContent = 'Saved — refreshing...';
                        setTimeout(()=> location.reload(), 600);
                        return;
                    }
                    status.textContent = 'Save failed';
                }catch(err){
                    console.error(err);
                    status.textContent = 'Save error';
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = orig;
                }
            });
        })();
        </script>

        <!-- iro.js color wheel (modern picker) -->
        <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5.5.1/dist/iro.min.js"></script>
        <script>
        (function(){
            // main picker
            try{
                const mainHidden = document.getElementById('main_color');
                const mainHex = document.getElementById('main_color_hex');
                const subHidden = document.getElementById('sub_color');
                const subHex = document.getElementById('sub_color_hex');

                const mainPicker = new iro.ColorPicker('#main_color_picker', { width: 160, color: mainHidden.value || '#1e40af' });
                const subPicker = new iro.ColorPicker('#sub_color_picker', { width: 160, color: subHidden.value || '#ffd41d' });

                mainPicker.on('color:change', function(color){
                    mainHidden.value = color.hexString;
                    if(mainHex) mainHex.value = color.hexString;
                });
                subPicker.on('color:change', function(color){
                    subHidden.value = color.hexString;
                    if(subHex) subHex.value = color.hexString;
                });

                if(mainHex){ mainHex.addEventListener('input', function(e){ try{ mainPicker.color.hexString = e.target.value; }catch{} }); }
                if(subHex){ subHex.addEventListener('input', function(e){ try{ subPicker.color.hexString = e.target.value; }catch{} }); }
            }catch(e){ console.warn('color picker init failed', e); }
        })();
        </script>

    <div class="settings-section" style="border-top:2px solid #f0f0f0; padding-top:20px;">
        <h5 style="color:#f44336;">Danger Zone</h5>
        <p style="color:#666; margin-bottom:15px;">These actions cannot be undone. Please proceed with caution.</p>
        <button class="btn btn-outline-danger">Reset All Settings to Default</button>
        <button class="btn btn-danger ms-2">Delete Account & Data</button>
    </div>
</div>
{% endblock %}
